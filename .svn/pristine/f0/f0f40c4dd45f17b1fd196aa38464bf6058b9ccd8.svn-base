package com.swust.vhas.controller;

import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.ResponseBody;

import com.swust.vhas.model.Video;
import com.swust.vhas.service.VideoService;
import com.swust.vhas.view.JsonAndView;

@Controller
@RequestMapping(value = "/video")
public class VideoController {

	@Autowired
	VideoService videoService;

	@RequestMapping(value = "/top", method = RequestMethod.GET)
	@ResponseBody
	public JsonAndView top(String time, Integer page, Integer size, String order, String type, Integer web) {
		Calendar calendar = Calendar.getInstance();
		calendar.set(Calendar.HOUR_OF_DAY, 0);
		calendar.set(Calendar.MINUTE, 0);
		calendar.set(Calendar.SECOND, 0);
		calendar.set(Calendar.MILLISECOND, 0);
		if ("day".equals(time)) {
			calendar.add(Calendar.DATE, -1);
		} else if ("week".equals(time)) {
			calendar.add(Calendar.WEEK_OF_YEAR, -1);
		} else if ("month".equals(time)) {
			calendar.add(Calendar.MONTH, -1);
		} else if ("year".equals(time)) {
			calendar.add(Calendar.YEAR, -1);
		} else {
			calendar = null;
		}
		if (calendar != null) {
			SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
			time = sdf.format(calendar.getTime());
		}
		//
		if (page == null || page < 1)
			page = 1;
		if (size == null || size < 1)
			size = 10;
		List<Video> videos = videoService.selectTop(time, page, size, order, type, web);
		JsonAndView jsonAndView = new JsonAndView();
		jsonAndView.addData("page", page);
		jsonAndView.addData("size", size);
		jsonAndView.addData("order", order);
		jsonAndView.addData("type", type);
		jsonAndView.addData("web", web);
		jsonAndView.addData("videos", videos);
		return jsonAndView;
	}
}
